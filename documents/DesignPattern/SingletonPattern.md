# Singleton Pattern

싱글톤 패턴은 아주 단순한 패턴이다. 싱글톤 패턴에서는 생성자가 여러번 호출 되더라도 실제로 호출되는 객체는 하나이고 최초 호출 이 후에는 이미 생성한 하나의 객체를 계속해서 반환한다. 즉, 하나의 클래스에 하나의 객체만 가지고 있다고 해서 싱글톤 패턴이라고 한다. 클래스와 인스턴스의 관계가 일대 일 관계 인 것이다.

단 하나의 인스턴스만 가져야 하는 클래스를 관리할 때 이 싱글톤 패턴이 사용되며 인스턴스가 둘 이상 만들어지면 심각한 논리 오류가 발생하기 때문에 보통의 경우 생성자를 감추는 방법을 이용한다. 이런 방법은 단일성을 강제하는 방법이지만 단일성을 강제하는 비용에 비해 이 패턴을 사용하는 이익이 더 크기 때문에 싱글톤 패턴이 사용된다.

## 구현

```csharp
public class Singleton{
	private static Singleton theInstance = null;
	private Singleton(){
	}
	public static Singleton Instance() {
		if (this.theInstance == null)
			this.theInstance = new Singleton();
		return this.theInstance;
	}
}
```

Singleton Pattern 은 보통 위와 같은 방법으로 구현된다. Static 변수가 내부 변수로 존재하고 생성자는 private로 정의된다. 생성자가 private로 정의되어 있기 때문에 외부에서는 생성자를 호출 할 수 없다. 외부에서 호출할 수 있는 것은 인터페이스로 내 놓은 Instance()라는 함수이며 이 함수는 처음 호출 되었을 때 내부의 Static 변수에 생성자를 호출하여 할당하고 그 다음 부터는 이 내부 Static 변수를 반환한다. 

## 장점

- **플랫폼 호환:** 적절한 미들웨어를 이용한다면, 싱글톤은 많은 JVM과 컴퓨터에서 적용되어 확장될 수 있다.
- **어떤 클래스에도 적용이 가능:** 구현이 간단하기 때문에 어떤 클래스에서도 생성자를 감추로 정적 변수와 함수를 이용하여 싱글톤을 만들어 낼 수 있다.
- **파생을 통해 생성 가능:** 주어진 클래스에서 싱글톤이 서브 클래스를 만들 수 있다.
- **게으른 처리(Lazy Evaluation):** 싱글톤의 인스턴스를 사용하지 않는다면 이 인스턴스를 생성하지 않는다.

## 비용

- **소멸이 정의되어 있지 않다:** 싱글톤을 없애거나 사용을 중지하는 좋은 방법이 없다. 일단 한번 만들게 되면 소멸시키기가 어렵다. 해당 static변수를 null로 처리하는 함수를 추가한다고 하더라도 시스템의 어느 부분에서 이 값을 참조하고 있을 지 알 수 없기 때문에 문제가 생길 수 있다.
- **상속되지 않는다:** 싱글톤을 사용한 클래스를 상속한 클래스는 싱글톤이 아니다.
- **효율성:** 인스턴스를 호출할 때 무조건 if문을 거쳐서 호출이 된다. 대부분의 경우 이 if 문은 쓸모가 없다.
- **비투명성:** 싱글톤 사용자는 Instance라는 매소드를 통해 인스턴스에 접근해야 하기 때문에 자신이 싱글톤을 사용한다는 사실을 알아야 한다.

## 싱글톤 패턴의 사용

싱글톤 패턴은 주로 공통된 객체를 여러개 생성해야 하는 데이터베이스 통신 객체와 같은 경우에서 사용된다. 데이터베이스와 통신하는 객체가 단일 인스턴스를 통해 이루어진다면 데이터베이스에 접근하는 동작을 할 때 검사, 카운터, 락 등에 대한 규정을 강제하기가 쉬워진다. 

## 주의할 점

- 다중 스레드 환경에서 1개 이상의 인스턴스가 생성될 수 있다.

    게으른 처리를 이용하여 인스턴스 생성 시, 스레드 간의 동기화를 잘 유지시켜야 한다.

- 싱글톤 인스턴스에 너무 많은 책임이 몰려서 개방-폐쇄 원칙을 위반할 수 있다.

    싱글톤은 간편한 만큼 여러 클래스들과 쉽게 엮일 수 있다. 클래스 간에 결합도가 너무 높아지면 개방-폐쇄  원칙을 어기게 될 수 있다.

---

참고. 로버트C마틴. 클린 소프트웨어 애자일 원칙과 패턴 그리고 실천 방법 (이용원, 김정민, 정지호 옮김) 

참고. "싱글턴 패턴", Wikipedia
